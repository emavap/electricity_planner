# REQUIRED: Install "Gauge Card Pro" from HACS
# https://github.com/custom-cards/gauge-card-pro
# This dashboard uses dynamic thresholds that update based on configuration

views:
  - title: Electricity Planner
    path: electricity-planner
    icon: mdi:lightning-bolt
    panel: true
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## ⚡ Electricity Planner Dashboard
              Net contract prices, charging recommendations, and live power context – all in one place.

          - type: grid
            square: false
            columns: 3
            cards:
              - type: custom:gauge-card-pro
                entity: sensor.electricity_planner_current_electricity_price
                name: Buy price
                unit: "€/kWh"
                min: 0
                max: 0.40
                needle: true
                scale: 50px
                severity:
                  - color: "#43a047"
                    from: 0
                    to_entity: sensor.electricity_planner_diagnostics_monitoring_price_threshold
                  - color: "#ffa600"
                    from_entity: sensor.electricity_planner_diagnostics_monitoring_price_threshold
                    to_entity: sensor.electricity_planner_diagnostics_monitoring_price_threshold
                    to_entity_multiplier: 1.2
                  - color: "#db4437"
                    from_entity: sensor.electricity_planner_diagnostics_monitoring_price_threshold
                    from_entity_multiplier: 1.2
                    to: 0.40

              - type: custom:gauge-card-pro
                entity: sensor.electricity_planner_diagnostics_monitoring_current_feed_in_price
                name: Feed-in price
                unit: "€/kWh"
                min: -0.20
                max: 0.20
                needle: true
                scale: 50px
                severity:
                  - color: "#db4437"
                    from: -0.20
                    to: 0
                  - color: "#ffa600"
                    from: 0
                    to_entity: sensor.electricity_planner_diagnostics_monitoring_feed_in_price_threshold
                  - color: "#43a047"
                    from_entity: sensor.electricity_planner_diagnostics_monitoring_feed_in_price_threshold
                    to: 0.20

              - type: entities
                title: Price adjustments
                show_header_toggle: false
                entities:
                  - entity: sensor.electricity_planner_current_electricity_price
                    type: attribute
                    name: Raw Nord Pool price
                    attribute: raw_current_price
                  - entity: sensor.electricity_planner_current_electricity_price
                    type: attribute
                    name: Consumption multiplier
                    attribute: price_adjustment_multiplier
                  - entity: sensor.electricity_planner_current_electricity_price
                    type: attribute
                    name: Consumption offset
                    attribute: price_adjustment_offset
                  - entity: sensor.electricity_planner_diagnostics_monitoring_current_feed_in_price
                    type: attribute
                    name: Feed-in multiplier
                    attribute: feedin_multiplier
                  - entity: sensor.electricity_planner_diagnostics_monitoring_current_feed_in_price
                    type: attribute
                    name: Feed-in offset
                    attribute: feedin_offset
                  - entity: sensor.electricity_planner_diagnostics_monitoring_feed_in_price_threshold
                    name: Feed-in threshold

          - type: horizontal-stack
            cards:
              - type: button
                name: Battery
                entity: binary_sensor.electricity_planner_battery_charge_from_grid
                icon: mdi:battery-charging
                show_state: true

              - type: button
                name: Car
                entity: binary_sensor.electricity_planner_car_charge_from_grid
                icon: mdi:car-electric
                show_state: true
                tap_action:
                  action: more-info

              - type: button
                name: Data OK
                entity: binary_sensor.electricity_planner_data_nord_pool_available
                icon: mdi:database-check
                show_state: true

          - type: entities
            title: Decision reasons & controls
            show_header_toggle: false
            entities:
              - entity: sensor.electricity_planner_charging_recommendation_reason
                name: Overall decision

              - entity: binary_sensor.electricity_planner_battery_charge_from_grid
                name: Battery charging
                secondary_info: last-changed

              - entity: binary_sensor.electricity_planner_car_charge_from_grid
                name: Car charging
                secondary_info: last-changed

              - entity: sensor.electricity_planner_car_charger_limit
                name: Car charger limit

              - entity: sensor.electricity_planner_grid_setpoint
                name: Grid setpoint

          - type: grid
            square: false
            columns: 2
            cards:
              - type: gauge
                name: Solar surplus
                entity: sensor.electricity_planner_solar_surplus_power
                min: 0
                max: 8000
                unit: W
                needle: true

              - type: gauge
                name: Battery SOC
                entity: sensor.electricity_planner_battery_soc_average
                min: 0
                max: 100
                unit: "%"
                needle: true

              - type: entities
                title: Power & status
                show_header_toggle: false
                entities:
                  - entity: sensor.electricity_planner_solar_surplus_power
                    name: Solar surplus

                  - entity: binary_sensor.electricity_planner_solar_producing_power
                    name: Solar producing

                  - entity: binary_sensor.electricity_planner_price_below_threshold
                    name: Price below threshold

                  - entity: sensor.electricity_planner_data_unavailable_duration
                    name: Data unavailable time

          - type: entities
            title: Configuration thresholds
            show_header_toggle: false
            entities:
              - entity: sensor.electricity_planner_diagnostics_monitoring_price_threshold
                name: Price threshold

              - entity: sensor.electricity_planner_diagnostics_monitoring_very_low_price_threshold
                name: Very low price %

              - entity: sensor.electricity_planner_diagnostics_monitoring_emergency_soc_threshold
                name: Emergency SOC

              - entity: sensor.electricity_planner_diagnostics_monitoring_significant_solar_threshold
                name: Significant solar

              - entity: sensor.electricity_planner_diagnostics_monitoring_feed_in_price_threshold
                name: Feed-in threshold

          - type: history-graph
            title: Price vs decisions (48h)
            hours_to_show: 48
            refresh_interval: 300
            entities:
              - entity: sensor.electricity_planner_current_electricity_price
                name: Buy price
              - entity: sensor.electricity_planner_diagnostics_monitoring_current_feed_in_price
                name: Feed-in price
              - entity: binary_sensor.electricity_planner_battery_charge_from_grid
                name: Battery charging
              - entity: binary_sensor.electricity_planner_car_charge_from_grid
                name: Car charging
